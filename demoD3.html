<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-opacity: .6;
}

svg {
   -webkit-touch-callout: none;
   -webkit-user-select: none;
   -khtml-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
   user-select: none;
}

</style>
<body>
<!--<script src="http://d3js.org/d3.v3.min.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="demoD3.js"></script>
<script>

var width = 900,
    height = 900;

var color = d3.scale.category20();

var force = d3.layout.force()
    .charge(-5000)
    .linkDistance(150)
    .size([width, height]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

function setData(nodes, links) {
  force
      .nodes(nodes)
      .links(links)
      .start();

  svg.selectAll(".link").remove();
  var link = svg.selectAll(".link")
      .data(force.links())
    .enter().append("line")
      .attr("class", "link")
      .style("stroke-width", function(d) { return d.value; });

  svg.selectAll(".gnode").remove();
  var gnodes = svg.selectAll(".gnode")
      .data(force.nodes())
    .enter().append("g")
      .classed("gnode", true)
      .call(force.drag);

  var node = gnodes.append("circle")
      .attr("class", "node")
      .attr("r", 15)
      .style("fill", function(d) { return d.reality ? "red" : "lightblue"; });

  var labels = gnodes.append("text")
      .attr("text-anchor", "middle")
      .attr("x", 0)
      .attr("y", ".3em")
      .text(function(d) { return d.name; });

  force.on("tick", function() {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    gnodes.attr("transform", function(d) {
       return 'translate(' + [d.x, d.y] + ')';
    });
  });
}

var worlds, players, links;
function initKripke(spies, resistance) {
  worlds = initWorlds(spies,resistance);
  players = {};
  for (var i = 0; i < worlds.length; i++) {
    var world = worlds[i];
    (players[world[0]] = players[world[0]] || []).push(i);
    (players[world[1]] = players[world[1]] || []).push(i);
  }

  links = [];
  for (var player in players) {
    var ws = players[player];
    for (var i = 0; i < ws.length; i++) {
      for (var j = 0; j < ws.length; j++) {
        links.push({source: ws[i], target: ws[j], player: i});
      }
    }
  }

  var nodes = worlds.map(function(a){return {name:a};});
  //nodes[0].reality = true;

  setData(nodes, links);
}
initKripke(3,2);
</script>
